ğŸ§  Tutorial Simples â€“ Sistema Python da Lixeira Inteligente

Este script Python funciona como um monitor em tempo real que lÃª dados do Arduino e envia alertas automÃ¡ticos no Telegram quando a lixeira fica cheia.

Vamos dividir por partes para entender.

1ï¸âƒ£ O que esse programa faz?

âœ” Detecta automaticamente a porta do Arduino
âœ” LÃª o texto que o Arduino envia pela porta Serial
âœ” Entende quando a lixeira estÃ¡ â€œCHEIAâ€ ou â€œOKâ€
âœ” Envia alerta para todos os usuÃ¡rios cadastrados no Telegram
âœ” Reenvia alertas periÃ³dicos enquanto a lixeira continua cheia
âœ” Registra todos os usuÃ¡rios que enviaram qualquer mensagem ao bot





2ï¸âƒ£ Como o bot sabe para quem enviar?

Quando alguÃ©m envia uma mensagem para o bot (mesmo que â€œoiâ€), o script:

pega o chat_id

salva em usuarios.txt

adiciona Ã  lista de usuÃ¡rios registrados

Depois disso, o bot sempre enviarÃ¡ alertas para essa pessoa.





3ï¸âƒ£ Como ele encontra o Arduino

A funÃ§Ã£o:

encontrar_porta_arduino()


Procura automaticamente portas como:

â€œArduinoâ€

â€œCH340â€

â€œUSB-SERIALâ€

â€œCDC ACMâ€

Se achar, tenta abrir.
Se nÃ£o achar, testa todas as portas atÃ© encontrar uma que funcione.

ğŸ’¡ Isso evita que vocÃª tenha que ficar mudando COM3, COM4, etc.





4ï¸âƒ£ Como o Python lÃª os dados do Arduino

O Arduino manda coisas como:

DISTANCIA: 12.30 cm
LIXEIRA_CHEIA
LIXEIRA_OK


O Python:

LÃª todas as linhas enviadas

Junta partes incompletas

Identifica trÃªs tipos de linha:

A) Leituras contÃ­nuas
if linha.startswith("DISTANCIA:"):


Mostra no console:

â†’ DistÃ¢ncia: 12.30 cm

B) Evento "LIXEIRA_CHEIA"

Quando a linha for exatamente isso:

LIXEIRA_CHEIA


O Python:

marca lixeira_cheia = True

envia alerta para todos os usuÃ¡rios

registra o momento do alerta

C) Evento "LIXEIRA_OK"

O Python faz:

lixeira_cheia = False

apenas informa no console

para de reenviar alertas





5ï¸âƒ£ Reenvio automÃ¡tico enquanto estiver cheia

Mesmo sem novas mensagens do Arduino, o Python verifica:

if lixeira_cheia:
    # reenviar alerta a cada INTERVALO_ALERTA


PadrÃ£o: 5 segundos

ğŸ“Œ Por quÃª?
Para garantir que o alerta nÃ£o seja perdido pelo Telegram.





6ï¸âƒ£ Como o Python envia mensagens pelo Telegram

O envio Ã© feito por chamadas HTTP usando requests.

Envio do texto:
requests.get(
    f"https://api.telegram.org/bot{TOKEN}/sendMessage",
    params={"chat_id": chat_id, "text": MENSAGEM_CHEIA}
)

Envio do Ã¡udio (caso exista um OGG):
requests.post(
    f"https://api.telegram.org/bot{TOKEN}/sendVoice",
    files={'voice': open(OGG_FILE, 'rb')},
    data={'chat_id': chat_id}
)





7ï¸âƒ£ Ciclo principal

O programa fica em loop infinito:

Atualiza usuÃ¡rios usando getUpdates

LÃª o Arduino

Processa linhas

Reenvia alertas se a lixeira ainda estiver cheia

Aguarda 20 ms para nÃ£o travar a CPU

Ele continua rodando atÃ© vocÃª apertar CTRL + C.





8ï¸âƒ£ Arquivos usados pelo sistema
ğŸ“„ usuarios.txt

Guarda IDs das pessoas que interagiram com o bot.

ğŸ”Š lixeira_cheia.ogg

Ãudio opcional enviado junto com o alerta.

ğŸ”Œ Porta Serial

Detectada automaticamente.





9ï¸âƒ£ Como usar o sistema

Conecte o Arduino no PC

Rode o Python:

python seu_arquivo.py


Abra o Telegram e mande qualquer mensagem para o bot

A lixeira chega ao nÃ­vel crÃ­tico

O Arduino envia LIXEIRA_CHEIA

O Python detecta e envia alertas

Quando o lixo Ã© retirado â†’ LIXEIRA_OK

Pronto.
VocÃª tem um sistema de coleta inteligente funcional e automatizado.